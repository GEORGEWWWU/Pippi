# 🕷️ 皮皮蛛 (PippiSpider)

一只懂得休息、会跳过已下载、绝不给主人添麻烦的乖蜘蛛。现在有了漂亮的图形界面！

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![GUI](https://img.shields.io/badge/Interface-Tkinter-orange.svg)

## ✨ 特性

- 🧑‍💻 **图形界面** - 直观易用的GUI界面，无需命令行操作
- 📥 **断点续传** - 自动检测已下载文件，随时中断随时继续
- 📊 **实时进度** - 可视化进度条和详细日志显示
- 🛡️ **智能反爬** - 动态延迟、User-Agent轮换、请求频率控制
- 🎯 **万能提取** - 支持任意格式（JPG/PNG/WEBP/GIF等），不限于特定前缀
- 🔗 **直接链接** - 支持直接输入图片URL进行单张下载
- 📁 **智能命名** - 自动保留原始文件名，自动清理非法字符
- 🔧 **零配置** - 开箱即用，无需修改代码
- ⏹️ **可控停止** - 随时中断下载，不会损坏已下载文件

## 📦 安装依赖

```bash
pip install requests beautifulsoup4 pillow
```

> **注意**: 
> - tkinter 通常随 Python 一起安装，如果没有，请根据你的系统安装：
>   - Ubuntu/Debian: `sudo apt-get install python3-tk`
>   - Fedora: `sudo dnf install python3-tkinter`
>   - macOS: tkinter 通常已包含在 Python 中
>   - Windows: tkinter 通常已包含在 Python 中
> - pillow 用于GUI界面中的图标显示，如果没有安装，程序会使用emoji替代图标

## 🚀 快速开始

### 启动GUI界面

```bash
python pippi_gui.py
```

### 使用流程

1. **输入目标链接** - 在GUI界面中输入要爬取的页面URL或直接图片链接
2. **选择保存目录** - 设置图片保存的文件夹位置
3. **开始下载** - 点击"开始下载"按钮启动爬虫
4. **监控进度** - 实时查看下载进度和日志信息
5. **随时停止** - 如需中断可点击"停止"按钮

### 支持的链接类型

1. **网页链接** - 包含图片的网页URL，程序会自动提取所有图片
   - 示例：`https://bing.fullpx.com/`
   - 示例：`https://www.pixiv.net/artworks/12345678`

2. **直接图片链接** - 以图片扩展名结尾的直接URL
   - 示例：`https://example.com/photo.jpg`
   - 示例：`https://i.pximg.net/img-original/img/2023/01/01/00/00/00/12345678_p0.png`

### GUI界面功能

- **链接输入框** - 预设默认链接，可修改为任意目标URL
- **目录选择** - 支持手动输入或浏览选择保存目录
- **进度条** - 可视化显示下载进度百分比
- **实时日志** - 详细显示下载状态、成功/失败/跳过信息
- **控制按钮** - 开始/停止下载操作

## 🖼️ 界面预览

```
┌─────────────────────────────────────────────────────────────────┐
│  🕷️ 皮皮蛛图片下载器                                    - □ × │
├─────────────────────────────────────────────────────────────────┤
│  下载设置                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 目标链接: [https://bing.fullpx.com/                ]   │   │
│  │ 保存目录: [pippi_images                     ] [浏览...] │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [🚀 开始下载] [⏹️ 停止]                                         │
│                                                                 │
│  ████████████████████████████████████████░░░░░░░░  75/100 (75%)│
│  75/100 (75.0%)                                                 │
│                                                                 │
│  运行日志                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 📂 发现 20 个已下载的文件，将自动跳过                      │   │
│  │ 🚀 开始爬取: https://bing.fullpx.com/                     │   │
│  │ 🔍 找到 50 个图片链接                                     │   │
│  │ 🎯 共发现 50 张图片                                       │   │
│  │   ✓ [1] photo_001.jpg (856.3 KB)                         │   │
│  │   ⏭️  [2] photo_002.jpg (已存在)                          │   │
│  │   ✓ [3] photo_003.jpg (768.2 KB)                         │   │
│  │ 💤 已下载 10/50，休息中...                                │   │
│  │ ...                                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## ⚙️ 配置说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `pippi_images` | str | `"pippi_images"` | 图片保存目录 |
| `min_delay` | float | `1.5` | 最小请求延迟(秒) |
| `max_delay` | float | `5.0` | 最大请求延迟(秒) |
| `retries` | int | `3` | 失败重试次数 |
| `pixiv_cookie` | str | `"PHPSESSID=88843137_JNDfSY4N0W1gND6Hu4Iuq3qCO2pFzRh3"` | Pixiv登录凭证，用于下载高清原图 |

### Pixiv配置

要下载Pixiv的高清原图，需要配置Pixiv的PHPSESSID：

1. 登录Pixiv网站
2. 打开浏览器开发者工具(F12)
3. 在Network标签中找到任意请求
4. 在Request Headers中找到Cookie字段
5. 复制其中的`PHPSESSID=xxxxx`部分
6. 在`pippi_core.py`中更新`pixiv_cookie`变量

> **注意**: 配置Pixiv Cookie仅用于获取高清原图，不配置也能下载，但可能只能获取缩略图

## 🛡️ 反爬策略

皮皮蛛采用以下策略避免被封：

1. **随机延迟** - 基础延迟1.5秒，随下载数量递增（最大5秒）
2. **UA轮换** - 3个不同浏览器的User-Agent随机切换
3. **无Referer** - 严格遵守目标站要求，不添加Referer头
4. **批量休息** - 每下载10张自动休息3-6秒
5. **指数退避** - 请求失败时采用指数退避重试

## 🎯 图片提取策略

| 优先级 | 方法 | 说明 |
|--------|------|------|
| 1 | Pixiv API | 针对Pixiv网站，调用Ajax API获取高清原图 |
| 2 | 通用正则 | 匹配所有常见图片格式链接 |
| 3 | BeautifulSoup | 解析img标签、data-src等属性 |
| 4 | 懒加载正则 | 匹配背景图、延迟加载图片 |

支持的格式：`.jpg` `.jpeg` `.png` `.webp` `.gif` `.bmp` `.tiff` `.avif`

### Pixiv特殊处理

Pixiv网站采用专门的API获取方式：

1. **自动识别** - 检测URL中是否包含`pixiv.net`或`pximg.net`
2. **提取ID** - 从URL中提取作品ID（artworks/12345或illust_id=12345）
3. **调用API** - 使用Ajax API获取高清原图链接
4. **回退机制** - API失败时自动回退到HTML解析

Pixiv API返回的图片质量优先级：
1. `original_pic_url` - 最高质量原图
2. `original` - 原始尺寸
3. `regular` - 常规尺寸

## 📁 项目结构

```
pippi-spider/
├── pippi_gui.py       # GUI界面程序
├── pippi_core.py      # 核心爬虫类
├── README.md          # 本文件
├── Pippi-logo.ico     # 应用程序图标
└── pippi_images/      # 默认下载目录
    ├── photo_01.png
    ├── img_0001_a3f7.jpg
    └── ...
```

### 核心文件说明

- **pippi_gui.py** - 基于tkinter的图形用户界面，提供友好的交互体验
- **pippi_core.py** - 爬虫核心功能，包含图片提取、下载、反爬策略等
- **Pippi-logo.ico** - 应用程序图标，用于GUI界面显示

## 🎮 运行示例

### GUI界面使用流程

1. **启动程序**
   ```
   python pippi_gui.py
   ```

2. **界面操作**
   - 在"目标链接"输入框中输入URL（默认已填入示例链接）
   - 在"保存目录"中设置下载位置（默认为pippi_images）
   - 点击"浏览..."按钮可选择自定义目录

3. **下载过程**
   - 点击"� 开始下载"按钮启动爬虫
   - 进度条显示下载百分比
   - 日志区域实时显示下载状态：
     ```
     � 发现 20 个已下载的文件，将自动跳过
     🚀 开始爬取: https://bing.fullpx.com/
     🔍 找到 50 个图片链接
     🎯 共发现 50 张图片
       ✓ [1] photo_001.jpg (856.3 KB)
       ⏭️  [2] photo_002.jpg (已存在)
       ✓ [3] photo_003.jpg (768.2 KB)
     💤 已下载 10/50，休息中...
     ✅ 下载完成！成功: 30, 跳过: 20, 失败: 0
     ```

4. **完成提示**
   - 下载完成后弹出提示框显示结果
   - 可继续使用同一界面下载其他链接

### 高级功能

- **随时停止** - 下载过程中可点击"⏹️ 停止"按钮中断
- **断点续传** - 重新下载相同链接时自动跳过已存在文件
- **智能重试** - 下载失败自动重试，提高成功率

## ⚠️ 注意事项

1. **合法使用** - 请确保你有权下载目标网站的图片
2. **控制频率** - 即使有多重保护，也不要短时间内大量下载
3. **磁盘空间** - 确保下载目录有足够空间
4. **网络稳定** - 建议使用稳定的网络环境

## 🔧 故障排除

### 找不到图片链接
- 检查目标URL是否可访问
- 检查网页是否需要登录或特殊权限
- 尝试查看网页源代码确认图片链接格式

### 下载失败
- 检查网络连接
- 增加延迟时间（修改 `_get_random_delay` 参数）
- 查看是否有IP被封（暂停几小时后重试）

### 文件名乱码
- 程序已自动处理URL编码，如遇问题请检查系统编码设置

## 📝 更新日志

### v2.0.0 - GUI版本
- 🖥️ **全新GUI界面** - 基于tkinter的图形用户界面，操作更直观
- 📊 **可视化进度** - 实时进度条和详细日志显示
- ⏹️ **可控停止** - 随时中断下载，不会损坏已下载文件
- 📁 **目录选择** - 支持浏览选择保存目录
- 🔄 **架构重构** - 分离核心爬虫和GUI界面，代码更清晰
- 🧵 **多线程** - 后台下载不阻塞界面操作

### v1.0.0 - 命令行版本
- ✨ 支持交互式输入URL
- ✨ 支持任意图片格式提取
- ✨ 智能文件名处理
- ✨ 断点续传功能
- ✨ 循环下载多个链接

## 📜 开源协议

MIT License - 自由使用，后果自负 😄

---

Made with 🕸️ by [GEORGEWU](https://georgewu.top)